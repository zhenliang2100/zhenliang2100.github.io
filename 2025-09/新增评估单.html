<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>新增评估单 - iPad应用</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <script src="../js/back-button.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1E40AF',
                        secondary: '#3B82F6',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        info: '#6366F1',
                        light: '#F3F4F6',
                        dark: '#1F2937'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .tab-active {
                @apply bg-primary text-white border-b-2 border-primary;
            }
            .tab-inactive {
                @apply bg-gray-100 text-gray-600 border-b-2 border-transparent hover:bg-gray-200;
            }
            .form-label {
                @apply block text-sm font-medium text-gray-700 mb-1;
            }
            .form-input {
                @apply w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200;
            }
            .form-select {
                @apply w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200;
            }
            .form-textarea {
                @apply w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200 resize-y min-h-[100px];
            }
            .form-required {
                @apply text-danger;
            }
            .form-button {
                @apply bg-secondary hover:bg-secondary/90 text-white px-3 py-2 rounded-lg transition-colors duration-200;
            }
            .upload-area {
                @apply border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-colors duration-200 cursor-pointer;
            }
            .image-preview {
                @apply relative w-full h-40 bg-gray-100 rounded-lg overflow-hidden;
            }
            .image-preview img {
                @apply w-full h-full object-cover;
            }
            .image-remove {
                @apply absolute top-1 right-1 bg-danger text-white rounded-full w-6 h-6 flex items-center justify-center cursor-pointer;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-md fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <button class="text-primary text-xl px-2" id="back-button">
                    <i class="fa fa-arrow-left"></i>
                </button>
                <i class="fa fa-file-text text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-gray-800">新增评估单</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-colors duration-200" id="cancel-button">
                    取消
                </button>
                <button class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors duration-200" id="submit-button">
                    提交
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 pt-28 pb-12">
        <!-- 表单步骤Tab -->
        <div class="bg-white rounded-t-xl shadow-md mb-0">
            <div class="flex overflow-x-auto scrollbar-hide border-b border-gray-200">
                <button id="tab-vehicle" class="tab-active whitespace-nowrap px-6 py-3 text-sm font-medium">
                    车辆信息
                </button>
                <button id="tab-document" class="tab-inactive whitespace-nowrap px-6 py-3 text-sm font-medium">
                    牌证信息
                </button>
                <button id="tab-image" class="tab-inactive whitespace-nowrap px-6 py-3 text-sm font-medium">
                    图像信息
                </button>
            </div>
        </div>

        <!-- 表单内容区域 -->
        <div class="bg-white rounded-b-xl shadow-md p-6">
            <!-- 车辆信息表单 -->
            <div id="form-vehicle" class="space-y-6">
                <!-- 行驶证识别按钮 -->
                <div class="mb-6 flex items-center">
                    <button id="ocr-license-button" class="bg-secondary hover:bg-secondary/90 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center">
                        <i class="fa fa-camera mr-2"></i>
                        拍摄行驶证自动识别
                    </button>
                    <button type="button" class="form-button ml-2" onclick="recognizeVIN()">车架号自动识别</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- 销售顾问 -->
                    <div>
                        <label class="form-label">
                            销售顾问 <span class="form-required">*</span>
                        </label>
                        <select class="form-select" required>
                            <option value="">请选择</option>
                            <!-- 门店1 -->
                            <optgroup label="深圳嘀嘀虎园区店">
                                <option value="didi-shenzhen-yuanqu-zhangsan">张三</option>
                                <option value="didi-shenzhen-yuanqu-lisi">李四</option>
                                <option value="didi-shenzhen-yuanqu-wangwu">王五</option>
                            </optgroup>
                            <!-- 门店2 -->
                            <optgroup label="广州嘀嘀虎中心店">
                                <option value="didi-guangzhou-zhongxin-zhaoliu">赵六</option>
                                <option value="didi-guangzhou-zhongxin-qianqi">钱七</option>
                            </optgroup>
                            <!-- 门店3 -->
                            <optgroup label="北京嘀嘀虎旗舰店">
                                <option value="didi-beijing-qijian-wangba">王八</option>
                                <option value="didi-beijing-qijian-lijiu">李九</option>
                            </optgroup>
                        </select>
                    </div>

                    <!-- 车辆名称 -->
                    <div>
                        <label class="form-label">
                            品牌车型 <span class="form-required">*</span>
                        </label>
                        <select class="form-select" id="car-model">
                            <option value="">请选择</option>
                            <!-- 奥迪 -->
                            <optgroup label="奥迪">
                                <!-- A系列 -->
                                <optgroup label="A系列">
                                    <option value="audi-a4l">A4L</option>
                                    <option value="audi-a6l">A6L</option>
                                    <option value="audi-a8l">A8L</option>
                                </optgroup>
                                <!-- Q系列 -->
                                <optgroup label="Q系列">
                                    <option value="audi-q3">Q3</option>
                                    <option value="audi-q5l">Q5L</option>
                                    <option value="audi-q7">Q7</option>
                                </optgroup>
                            </optgroup>
                            <!-- 宝马 -->
                            <optgroup label="宝马">
                                <!-- 3系 -->
                                <optgroup label="3系">
                                    <option value="bmw-318i">318i</option>
                                    <option value="bmw-320i">320i</option>
                                    <option value="bmw-320li">320Li</option>
                                    <option value="bmw-330i">330i</option>
                                </optgroup>
                                <!-- 5系 -->
                                <optgroup label="5系">
                                    <option value="bmw-520i">520i</option>
                                    <option value="bmw-525li">525Li</option>
                                    <option value="bmw-530li">530Li</option>
                                </optgroup>
                            </optgroup>
                            <!-- 丰田 -->
                            <optgroup label="丰田">
                                <option value="toyota-corolla">卡罗拉</option>
                                <option value="toyota-camry">凯美瑞</option>
                                <option value="toyota-highlander">汉兰达</option>
                            </optgroup>
                            <!-- 本田 -->
                            <optgroup label="本田">
                                <option value="honda-civic">思域</option>
                                <option value="honda-accord">雅阁</option>
                                <option value="honda-cr-v">CR-V</option>
                            </optgroup>
                        </select>
                    </div>

                    <!-- 车架号 -->
                    <div>
                        <label class="form-label">
                            车架号 <span class="form-required">*</span>
                        </label>
                        <input type="text" class="form-input" placeholder="请输入" required>
                    </div>

                    <!-- 车牌号 -->
                    <div>
                        <label class="form-label">
                            车牌号 <span class="form-required">*</span>
                        </label>
                        <input type="text" class="form-input" placeholder="请输入" required>
                    </div>

                    <!-- 发动机号 -->
                    <div>
                        <label class="form-label">
                            发动机号 <span class="form-required">*</span>
                        </label>
                        <input type="text" class="form-input" placeholder="请输入" required>
                    </div>

                    <!-- 上牌时间 -->
                    <div>
                        <label class="form-label">
                            上牌时间 <span class="form-required">*</span>
                        </label>
                        <input type="date" class="form-input" required>
                    </div>

                    <!-- 上牌城市 (省市级联) -->
                    <div>
                        <label class="form-label">
                            上牌城市 <span class="form-required">*</span>
                        </label>
                        <select class="form-select" id="plate-city">
                            <option value="">请选择</option>
                            <option value="gd-gz">广东省-广州市</option>
                            <option value="gd-sz">广东省-深圳市</option>
                            <option value="gd-dg">广东省-东莞市</option>
                            <option value="bj-bj">北京市</option>
                            <option value="sh-sh">上海市</option>
                            <option value="zj-hz">浙江省-杭州市</option>
                            <option value="zj-nb">浙江省-宁波市</option>
                        </select>
                    </div>

                    <!-- 车辆所在地 -->
                    <div>
                        <label class="form-label">
                            车辆所在地 <span class="form-required">*</span>
                        </label>
                        <select class="form-select" id="vehicle-location">
                            <option value="">请选择</option>
                            <option value="gd-gz">广东省-广州市</option>
                            <option value="gd-sz">广东省-深圳市</option>
                            <option value="gd-dg">广东省-东莞市</option>
                            <option value="bj-bj">北京市</option>
                            <option value="sh-sh">上海市</option>
                            <option value="zj-hz">浙江省-杭州市</option>
                            <option value="zj-nb">浙江省-宁波市</option>
                        </select>
                    </div>

                    <!-- 表显里程 -->
                    <div>
                        <label class="form-label">
                            表显里程 <span class="form-required">*</span>
                        </label>
                        <input type="number" class="form-input" placeholder="请输入" required>
                    </div>

                    <!-- 使用性质 -->
                    <div>
                        <label class="form-label">
                            使用性质 <span class="form-required">*</span>
                        </label>
                        <select class="form-select" required>
                            <option value="">请选择</option>
                            <option value="non-operating">非营运</option>
                            <option value="operating">营运</option>
                            <option value="rental">租赁</option>
                            <option value="converted">营转非</option>
                            <option value="official">公务车</option>
                        </select>
                    </div>

                    <!-- 所有人性质 -->
                    <div>
                        <label class="form-label">
                            所有人性质 <span class="form-required">*</span>
                        </label>
                        <select class="form-select" required>
                            <option value="">请选择</option>
                            <option value="personal">个人</option>
                            <option value="company">公司</option>
                        </select>
                    </div>

                    <!-- 天窗 -->
                    <div>
                        <label class="form-label">
                            天窗 <span class="form-required">*</span>
                        </label>
                        <select class="form-select" required>
                            <option value="">请选择</option>
                            <option value="panoramic">全景天窗</option>
                            <option value="small">小天窗</option>
                            <option value="none">无天窗</option>
                        </select>
                    </div>

                    <!-- 车辆类别 -->
                    <div>
                        <label class="form-label">
                            车辆类别 <span class="form-required">*</span>
                        </label>
                        <select class="form-select" required>
                            <option value="">请选择</option>
                            <option value="replacement">置换车</option>
                            <option value="scrap">报废车</option>
                        </select>
                    </div>

                    <!-- 排放标准 -->
                    <div>
                        <label class="form-label">
                            排放标准
                        </label>
                        <select class="form-select">
                            <option value="">请选择</option>
                            <option value="national6">国6</option>
                            <option value="national5">国5</option>
                            <option value="national4">国4</option>
                            <option value="national3">国3</option>
                            <option value="national2">国2</option>
                            <option value="national1">国1</option>
                        </select>
                    </div>

                    <!-- 内饰颜色 -->
                    <div>
                        <label class="form-label">
                            内饰颜色
                        </label>
                        <select class="form-select">
                            <option value="">请选择</option>
                            <option value="black">黑色</option>
                            <option value="white">白色</option>
                            <option value="silver">银色</option>
                            <option value="red">红色</option>
                            <option value="blue">蓝色</option>
                            <option value="gray">灰色</option>
                            <option value="green">绿色</option>
                            <option value="brown">棕色</option>
                            <option value="purple">紫色</option>
                            <option value="champagne">香槟色</option>
                            <option value="yellow">黄色</option>
                            <option value="beige">米色</option>
                            <option value="gold">金色</option>
                            <option value="orange">橙色</option>
                            <option value="pink">粉色</option>
                            <option value="dual">双色</option>
                            <option value="silver-gray">银灰色</option>
                            <option value="pink">粉红色</option>
                            <option value="dark-gray">深灰色</option>
                            <option value="coffee">咖啡色</option>
                            <option value="other">其他</option>
                        </select>
                    </div>

                    <!-- 外观颜色 -->
                    <div>
                        <label class="form-label">
                            外观颜色
                        </label>
                        <select class="form-select">
                            <option value="">请选择</option>
                            <option value="black">黑色</option>
                            <option value="white">白色</option>
                            <option value="silver">银色</option>
                            <option value="red">红色</option>
                            <option value="blue">蓝色</option>
                            <option value="gray">灰色</option>
                            <option value="green">绿色</option>
                            <option value="brown">棕色</option>
                            <option value="purple">紫色</option>
                            <option value="champagne">香槟色</option>
                            <option value="yellow">黄色</option>
                            <option value="beige">米色</option>
                            <option value="gold">金色</option>
                            <option value="orange">橙色</option>
                            <option value="pink">粉色</option>
                            <option value="dual">双色</option>
                            <option value="silver-gray">银灰色</option>
                            <option value="pink">粉红色</option>
                            <option value="dark-gray">深灰色</option>
                            <option value="coffee">咖啡色</option>
                            <option value="other">其他</option>
                        </select>
                    </div>

                    <!-- 生产日期 -->
                    <div>
                        <label class="form-label">
                            生产日期
                        </label>
                        <input type="date" class="form-input">
                    </div>

                    <!-- 指导价 -->
                    <div>
                        <label class="form-label">
                            指导价
                        </label>
                        <input type="text" class="form-input" placeholder="请输入">
                    </div>

                    <!-- 是否购买新车 -->
                    <div>
                        <label class="form-label">
                            是否购买新车
                        </label>
                        <div class="flex items-center space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="buy-new-car" value="yes" class="form-radio text-primary">
                                <span class="ml-2">是</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="buy-new-car" value="no" class="form-radio text-primary">
                                <span class="ml-2">否</span>
                            </label>
                        </div>
                    </div>

                    <!-- 是否事故 -->
                    <div>
                        <label class="form-label">
                            是否事故 <span class="form-required">*</span>
                        </label>
                        <div class="flex items-center space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="is-accident" value="yes" class="form-radio text-primary" checked>
                                <span class="ml-2">是</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="is-accident" value="no" class="form-radio text-primary">
                                <span class="ml-2">否</span>
                            </label>
                        </div>
                    </div>

                    <!-- 综合评价 -->
                    <div>
                        <label class="form-label">
                            综合评价 <span class="form-required">*</span>
                        </label>
                        <select class="form-select" required>
                            <option value="">请选择</option>
                            <option value="excellent">优</option>
                            <option value="good">良</option>
                            <option value="average">一般</option>
                            <option value="poor">差</option>
                        </select>
                    </div>
                </div>

                <!-- 车况描述 (多行文本输入框) -->
                <div>
                    <label class="form-label">
                        车况描述 <span class="form-required">*</span>
                    </label>
                    <textarea class="form-textarea" placeholder="请输入" required></textarea>
                </div>
            </div>

            <!-- 牌证信息表单 (默认隐藏) -->
            <div id="form-document" class="space-y-6 hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- 钥匙数 -->
                    <div>
                        <label class="form-label">
                            钥匙数 <span class="form-required">*</span>
                        </label>
                        <input type="number" class="form-input" placeholder="请输入" required>
                    </div>

                    <!-- 过户次数 -->
                    <div>
                        <label class="form-label">
                            过户次数 <span class="form-required">*</span>
                        </label>
                        <input type="number" class="form-input" placeholder="请输入" required>
                    </div>

                    <!-- 交强险到期 -->
                    <div>
                        <label class="form-label">
                            交强险到期 <span class="form-required">*</span>
                        </label>
                        <input type="date" class="form-input" required>
                    </div>

                    <!-- 年审到期 -->
                    <div>
                        <label class="form-label">
                            年审到期 <span class="form-required">*</span>
                        </label>
                        <input type="date" class="form-input" required>
                    </div>

                    <!-- 商业险到期 -->
                    <div>
                        <label class="form-label">
                            商业险到期
                        </label>
                        <input type="date" class="form-input">
                    </div>

                    <!-- 原车主名称 -->
                    <div>
                        <label class="form-label">
                            原车主名称 <span class="form-required">*</span>
                        </label>
                        <input type="text" class="form-input" placeholder="请输入" required>
                    </div>

                    <!-- 原车主住址 -->
                    <div>
                        <label class="form-label">
                            原车主住址
                        </label>
                        <input type="text" class="form-input" placeholder="请输入">
                    </div>

                    <!-- 原车主电话 -->
                    <div>
                        <label class="form-label">
                            原车主电话 <span class="form-required">*</span>
                        </label>
                        <input type="tel" class="form-input" placeholder="请输入" required>
                    </div>
                </div>
            </div>

            <!-- 图像信息表单 (默认隐藏) -->
            <div id="form-image" class="space-y-6 hidden">
                <!-- 车辆图片 -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">车辆图片</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center relative">
                                <img src="https://picsum.photos/id/1071/400/300" alt="左前45度" class="absolute inset-0 w-full h-full object-cover rounded-lg">
                                <div class="absolute top-1 right-1 bg-danger text-white rounded-full w-6 h-6 flex items-center justify-center cursor-pointer">
                                    <i class="fa fa-times"></i>
                                </div>
                            </div>
                            <p class="text-xs text-center text-gray-600">左前45度</p>
                            <input type="file" class="hidden" accept="image/*">
                        </div>
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center relative">
                                <img src="https://picsum.photos/id/1072/400/300" alt="主驾驶全景" class="absolute inset-0 w-full h-full object-cover rounded-lg">
                                <div class="absolute top-1 right-1 bg-danger text-white rounded-full w-6 h-6 flex items-center justify-center cursor-pointer">
                                    <i class="fa fa-times"></i>
                                </div>
                            </div>
                            <p class="text-xs text-center text-gray-600">主驾驶全景</p>
                            <input type="file" class="hidden" accept="image/*">
                        </div>
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center relative">
                                <img src="https://picsum.photos/id/1073/400/300" alt="仪表盘" class="absolute inset-0 w-full h-full object-cover rounded-lg">
                                <div class="absolute top-1 right-1 bg-danger text-white rounded-full w-6 h-6 flex items-center justify-center cursor-pointer">
                                    <i class="fa fa-times"></i>
                                </div>
                            </div>
                            <p class="text-xs text-center text-gray-600">仪表盘</p>
                            <input type="file" class="hidden" accept="image/*">
                        </div>
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center relative">
                                <img src="https://picsum.photos/id/1074/400/300" alt="后排座椅" class="absolute inset-0 w-full h-full object-cover rounded-lg">
                                <div class="absolute top-1 right-1 bg-danger text-white rounded-full w-6 h-6 flex items-center justify-center cursor-pointer">
                                    <i class="fa fa-times"></i>
                                </div>
                            </div>
                            <p class="text-xs text-center text-gray-600">后排座椅</p>
                            <input type="file" class="hidden" accept="image/*">
                        </div>
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center relative">
                                <img src="https://picsum.photos/id/1075/400/300" alt="中控台全景" class="absolute inset-0 w-full h-full object-cover rounded-lg">
                                <div class="absolute top-1 right-1 bg-danger text-white rounded-full w-6 h-6 flex items-center justify-center cursor-pointer">
                                    <i class="fa fa-times"></i>
                                </div>
                            </div>
                            <p class="text-xs text-center text-gray-600">中控台全景</p>
                            <input type="file" class="hidden" accept="image/*">
                        </div>
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center relative">
                                <img src="https://picsum.photos/id/1076/400/300" alt="右后45度" class="absolute inset-0 w-full h-full object-cover rounded-lg">
                                <div class="absolute top-1 right-1 bg-danger text-white rounded-full w-6 h-6 flex items-center justify-center cursor-pointer">
                                    <i class="fa fa-times"></i>
                                </div>
                            </div>
                            <p class="text-xs text-center text-gray-600">右后45度</p>
                            <input type="file" class="hidden" accept="image/*">
                        </div>
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center relative">
                                <img src="https://picsum.photos/id/1077/400/300" alt="铭牌" class="absolute inset-0 w-full h-full object-cover rounded-lg">
                                <div class="absolute top-1 right-1 bg-danger text-white rounded-full w-6 h-6 flex items-center justify-center cursor-pointer">
                                    <i class="fa fa-times"></i>
                                </div>
                            </div>
                            <p class="text-xs text-center text-gray-600">铭牌</p>
                            <input type="file" class="hidden" accept="image/*">
                        </div>
                    </div>
                </div>

                <!-- 证件资料 -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">证件资料 </h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center relative">
                                <img src="https://picsum.photos/id/20/400/300" alt="行驶证" class="absolute inset-0 w-full h-full object-cover rounded-lg">
                                <div class="absolute top-1 right-1 bg-danger text-white rounded-full w-6 h-6 flex items-center justify-center cursor-pointer">
                                    <i class="fa fa-times"></i>
                                </div>
                            </div>
                            <p class="text-xs text-center text-gray-600">行驶证</p>
                            <input type="file" class="hidden" accept="image/*">
                        </div>
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center relative">
                                <img src="https://picsum.photos/id/21/400/300" alt="登记证1" class="absolute inset-0 w-full h-full object-cover rounded-lg">
                                <div class="absolute top-1 right-1 bg-danger text-white rounded-full w-6 h-6 flex items-center justify-center cursor-pointer">
                                    <i class="fa fa-times"></i>
                                </div>
                            </div>
                            <p class="text-xs text-center text-gray-600">登记证1</p>
                            <input type="file" class="hidden" accept="image/*">
                        </div>
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center relative">
                                <img src="https://picsum.photos/id/22/400/300" alt="登记证2" class="absolute inset-0 w-full h-full object-cover rounded-lg">
                                <div class="absolute top-1 right-1 bg-danger text-white rounded-full w-6 h-6 flex items-center justify-center cursor-pointer">
                                    <i class="fa fa-times"></i>
                                </div>
                            </div>
                            <p class="text-xs text-center text-gray-600">登记证2</p>
                            <input type="file" class="hidden" accept="image/*">
                        </div>
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center">
                                <i class="fa fa-cloud-upload text-3xl text-gray-400 mb-2"></i>
                                <p class="text-xs text-gray-500">上传图片</p>
                                <input type="file" class="hidden" accept="image/*">
                            </div>
                            <p class="text-xs text-center text-gray-600">登记证3</p>
                        </div>
                    </div>
                </div>

                <!-- 车辆视频 -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">车辆视频</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center">
                                <i class="fa fa-cloud-upload text-3xl text-gray-400 mb-2"></i>
                                <p class="text-xs text-gray-500">上传视频</p>
                                <input type="file" class="hidden" accept="video/*">
                            </div>
                            <p class="text-xs text-center text-gray-600">发动机工况</p>
                        </div>
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center">
                                <i class="fa fa-cloud-upload text-3xl text-gray-400 mb-2"></i>
                                <p class="text-xs text-gray-500">上传视频</p>
                                <input type="file" class="hidden" accept="video/*">
                            </div>
                            <p class="text-xs text-center text-gray-600">车况解说</p>
                        </div>

                    </div>
                </div>

                <!-- 其他图片 -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">其他图片</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="space-y-2">
                            <div class="upload-area h-40 flex flex-col items-center justify-center">
                                <i class="fa fa-cloud-upload text-3xl text-gray-400 mb-2"></i>
                                <p class="text-xs text-gray-500">上传图片</p>
                                <input type="file" class="hidden" accept="image/*" multiple>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // Tab切换逻辑
            const tabVehicle = document.getElementById('tab-vehicle');
            const tabDocument = document.getElementById('tab-document');
            const tabImage = document.getElementById('tab-image');
            const formVehicle = document.getElementById('form-vehicle');
            const formDocument = document.getElementById('form-document');
            const formImage = document.getElementById('form-image');

            tabVehicle.addEventListener('click', function() {
                setActiveTab(tabVehicle);
                showForm(formVehicle);
            });

            tabDocument.addEventListener('click', function() {
                setActiveTab(tabDocument);
                showForm(formDocument);
            });

            tabImage.addEventListener('click', function() {
                setActiveTab(tabImage);
                showForm(formImage);
            });

            function setActiveTab(activeTab) {
                [tabVehicle, tabDocument, tabImage].forEach(tab => {
                    if (tab === activeTab) {
                        tab.classList.remove('tab-inactive');
                        tab.classList.add('tab-active');
                    } else {
                        tab.classList.remove('tab-active');
                        tab.classList.add('tab-inactive');
                    }
                });
            }

            function showForm(activeForm) {
                [formVehicle, formDocument, formImage].forEach(form => {
                    if (form === activeForm) {
                        form.classList.remove('hidden');
                    } else {
                        form.classList.add('hidden');
                    }
                });
            }



            // 返回按钮逻辑
            const backButton = document.getElementById('back-button');
            backButton.addEventListener('click', function() {
                // 返回工单列表页面
                window.location.href = '工单列表.html';
            });

            // 取消按钮逻辑
            const cancelButton = document.getElementById('cancel-button');
            cancelButton.addEventListener('click', function() {
                // 返回工单列表页面
                window.location.href = '工单列表.html';
            });

            // 提交按钮逻辑
            const submitButton = document.getElementById('submit-button');
            submitButton.addEventListener('click', function() {
                // 这里应该实现表单提交逻辑
                alert('表单提交成功');
                // 提交成功后跳转到工单列表页面
                window.location.href = '工单列表.html';
            });

            // 文件上传逻辑
            const uploadAreas = document.querySelectorAll('.upload-area');
            uploadAreas.forEach(area => {
                area.addEventListener('click', function(e) {
                    // 如果点击的是删除按钮，不触发文件上传
                    if (e.target.closest('.fa-times') || e.target.closest('.bg-danger')) {
                        return;
                    }
                    const fileInput = this.parentElement.querySelector('input[type="file"]') || this.querySelector('input[type="file"]');
                    if (fileInput) {
                        fileInput.click();
                    }
                });
            });

            // 图片删除逻辑
            const removeButtons = document.querySelectorAll('.bg-danger');
            removeButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation(); // 阻止事件冒泡到上传区域
                    const uploadArea = this.closest('.upload-area');
                    if (uploadArea) {
                        // 这里应该实现图片删除逻辑，这里仅做示例
                        // 实际应用中应该从服务器删除图片并更新页面
                        uploadArea.parentElement.remove();
                    }
                });
            });

            // 行驶证识别按钮逻辑
            const ocrLicenseButton = document.getElementById('ocr-license-button');
            ocrLicenseButton.addEventListener('click', function() {
                // 检查是否支持MediaDevices API
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    alert('您的设备不支持摄像头功能或未授权访问');
                    return;
                }

                // 调用设备摄像头进行拍照
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                    .then(function(stream) {
                        // 创建视频元素用于显示摄像头预览
                        const video = document.createElement('video');
                        video.srcObject = stream;
                        video.play();

                        // 创建画布用于捕获图像
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');

                        // 等待视频加载完成后捕获图像
                        video.addEventListener('loadedmetadata', function() {
                            // 设置画布尺寸与视频相同
                            canvas.width = video.videoWidth;
                            canvas.height = video.videoHeight;

                            // 捕获图像
                            context.drawImage(video, 0, 0, canvas.width, canvas.height);

                            // 停止视频流
                            stream.getTracks().forEach(track => track.stop());

                            // 将图像转换为Base64编码
                            const imageData = canvas.toDataURL('image/jpeg');

                            // 模拟OCR识别过程
                            simulateOCRRecognition(imageData);
                        });
                    })
                    .catch(function(err) {
                        console.error('摄像头访问错误: ', err);
                        alert('无法访问摄像头，请检查权限设置');
                    });
            });

            // 模拟OCR识别过程
            function simulateOCRRecognition(imageData) {
                // 显示处理中的提示
                alert('正在识别行驶证信息，请稍候...');

                // 模拟异步处理
                setTimeout(function() {
                    // 模拟识别结果
                    const ocrResult = {
                        plateNumber: '粤B12345',
                        vin: 'LVSFDFAL9AN000001',
                        engineNumber: '12345678',
                        brand: '丰田凯美瑞',
                        registerDate: '2020-01-01',
                        vehicleType: '小型轿车'
                    };

                    // 填充表单字段
                    fillFormFields(ocrResult);

                    // 显示成功提示
                    alert('行驶证信息识别完成并已自动填写到表单中');
                }, 2000);
            }

            // 填充表单字段
            function fillFormFields(data) {
                // 车牌号
                const plateNumberInput = document.querySelector('input[placeholder="请输入"][required]');
                if (plateNumberInput) plateNumberInput.value = data.plateNumber;

                // 车架号
                const vinInputs = document.querySelectorAll('input[placeholder="请输入"][required]');
                if (vinInputs.length > 1) vinInputs[1].value = data.vin;

                // 发动机号
                if (vinInputs.length > 2) vinInputs[2].value = data.engineNumber;

                // 车辆名称
                const carModelSelect = document.getElementById('car-model');
                if (carModelSelect) {
                    // 根据识别的品牌选择对应的选项
                    const options = carModelSelect.options;
                    for (let i = 0; i < options.length; i++) {
                        if (options[i].text.includes(data.brand)) {
                            carModelSelect.selectedIndex = i;
                            break;
                        }
                    }
                }

                // 上牌时间（这里使用注册日期作为示例）
                const registerDateInput = document.querySelector('input[type="date"][required]');
                if (registerDateInput) registerDateInput.value = data.registerDate;
            }

            // 车架号自动识别函数
            function recognizeVIN() {
                // 检查是否支持MediaDevices API
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    alert('您的设备不支持摄像头功能或未授权访问');
                    return;
                }

                // 调用设备摄像头进行拍照
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                    .then(function(stream) {
                        // 创建视频元素用于显示摄像头预览
                        const video = document.createElement('video');
                        video.srcObject = stream;
                        video.play();

                        // 创建画布用于捕获图像
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');

                        // 等待视频加载完成后捕获图像
                        video.addEventListener('loadedmetadata', function() {
                            // 设置画布尺寸与视频相同
                            canvas.width = video.videoWidth;
                            canvas.height = video.videoHeight;

                            // 捕获图像
                            context.drawImage(video, 0, 0, canvas.width, canvas.height);

                            // 停止视频流
                            stream.getTracks().forEach(track => track.stop());

                            // 将图像转换为Base64编码
                            const imageData = canvas.toDataURL('image/jpeg');

                            // 模拟VIN识别过程
                            simulateVINRecognition(imageData);
                        });
                    })
                    .catch(function(err) {
                        console.error('摄像头访问错误: ', err);
                        alert('无法访问摄像头，请检查权限设置');
                    });
            }

            // 模拟VIN识别过程
            function simulateVINRecognition(imageData) {
                // 显示处理中的提示
                alert('正在识别车架号，请稍候...');

                // 模拟异步处理
                setTimeout(function() {
                    // 模拟识别结果
                    const vinResult = 'LVSFDFAL9AN000001';

                    // 填充车架号字段
                    fillVINField(vinResult);

                    // 显示成功提示
                    alert('车架号识别完成并已自动填写到表单中');
                }, 2000);
            }

            // 填充车架号字段
            function fillVINField(vin) {
                // 车架号
                const vinInputs = document.querySelectorAll('input[placeholder="请输入"][required]');
                if (vinInputs.length > 1) vinInputs[1].value = vin;
            }
        });
    </script>
</body>
</html>