# 新建评估单页面 PRD

## 1. 需求背景

销售顾问需要一个高效的工具来创建新的车辆评估单。该页面需要支持多步骤表单填写，包括车辆基本信息、牌证信息、图像资料上传等功能。页面采用分步骤Tab设计，数据需要实时保存并与后端系统同步，确保评估单信息的完整性和准确性。

## 2. 需求价值

通过提供标准化的车辆评估单创建界面，提升销售顾问的信息录入效率和准确性，同时减少人工录入错误，提高整体业务效率。

## 3. 期望结果

- 销售顾问能够通过分步骤表单快速创建完整的车辆评估单
- 支持车辆基本信息、牌证信息、图像资料三个主要功能模块
- 实现图片和视频的上传、预览和删除功能。
- 表单数据需要实时验证和保存，确保数据完整性

## 4. 功能需求

### 功能描述
提供车辆评估单创建页面，支持多步骤表单填写和多媒体文件管理，包含车辆信息、牌证信息、图像信息三个主要模块。

### 功能路径
功能路径：展业工具 -> 评估单列表 -> 新建评估单

### 功能权限
- 销售顾问：可创建新的评估单
- 运营经理：可创建新的评估单
- 系统管理员：完全权限

### 表单步骤设计
页面采用三个Tab步骤设计：
1. 车辆信息：基础车辆信息和车况描述（包含22个字段）
2. 牌证信息：车辆证件和保险信息（包含10个字段）
3. 图像信息：车辆图片、证件资料和视频上传


### 车辆信息表单字段
| 字段名称 | 字段格式 | 是否必填 | 默认值 | 选项 |
|---------|---------|---------|--------|------|
| 销售顾问 | 文本，长度50 | 是 | 无 | "请输入"，选择当面门店关联的销售顾问 |
| 品牌车型 | 文本，长度100 | 是 | 空 | "请输入" ，支持选择库中的所有品牌车型，从主品牌- 子品牌 - 到车系、车型。|
| 车架号 | 文本，长度17 | 是 | 空 | "请输入" |
| 车牌号 | 文本，长度17，数字或者大写字母 | 是 | 空 | "请输入" ，若用户输入的小写字母，在失去焦点之后，转化成大写 |
| 发动机号 | 文本，长度20 | 是 | 空 | "请输入" |
| 上牌时间 | 日期，YYYY-MM-DD | 是 | 空 | 日期选择器 |
| 上牌城市 | 下拉选择 | 是 | 空 | 省市级联选项（广东省-广州市、广东省-深圳市、广东省-东莞市、北京市、上海市、浙江省-杭州市、浙江省-宁波市） |
| 车辆所在地 | 下拉选择 | 是 | 空 | 省市级联选项（广东省-广州市、广东省-深圳市、广东省-东莞市、北京市、上海市、浙江省-杭州市、浙江省-宁波市） |
| 表显里程 | 数字，0-999999，单位公里 | 是 | 空 | "请输入" |
| 使用性质 | 下拉选择 | 是 | 非营运 | 非营运/营运/营转非 |
| 所有人性质 | 下拉选择 | 是 | 个人 | 个人/单位 |
| 天窗 | 下拉选择 | 是 | 普通天窗 | 无天窗/普通天窗/全景天窗 |
| 车辆类别 | 下拉选择 | 是 | 置换车 | 置换车/收购车/寄售车 |
| 排放标准 | 下拉选择 | 是 | 国6 | 国3/国4/国5/国6 |
| 内饰颜色 | 下拉选择 | 是 | 空 | 黑色/白色/银色/灰色/红色/蓝色/绿色/棕色/金色/橙色/紫色/黄色/香槟色/其他 |
| 外观颜色 | 下拉选择 | 是 | 空 | 黑色/白色/银色/灰色/红色/蓝色/绿色/棕色/金色/橙色/紫色/黄色/香槟色/其他 |
| 生产日期 | 日期，YYYY-MM-DD | 是 | 空 | 日期选择器 |
| 指导价 | 数字，0-9999999.99，单位元 | 是 | 空 | "请输入指导价" |
| 是否购买新车 | 下拉选择 | 是 | 是 | 是/否 |
| 是否事故 | 下拉选择 | 是 | 否 | 是/否 |
| 综合评价 | 下拉选择 | 是 | 优 | 优/良/中/差 |
| 车况描述 | 多行文本，长度1000 | 否 | 空 | "请输入车况描述" |

### 牌证信息表单字段
| 字段名称 | 字段格式 | 是否必填 | 默认值 | 选项 |
|---------|---------|---------|--------|------|
| 钥匙数 | 数字，整数 ，0-9| 是 | 2 | "请输入" |
| 过户次数 | 数字，整数 ，0-9| 是 | 1 | "请输入" |
| 交强险到期 | 日期，YYYY-MM-DD | 是 | 空 | 日期选择器 |
| 年审到期 | 日期，YYYY-MM-DD | 是 | 空 | 日期选择器 |
| 商业险到期 | 日期，YYYY-MM-DD | 是 | 空 | 日期选择器 |
| 原车主名称 | 文本，长度50 | 是 | 空 | "请输入" |
| 原车主住址 | 文本，长度200 | 否 | 空 | "请输入" |
| 原车主电话 | 手机号，11位数字 | 是 | 空 | "请输入" |

#### 图像信息表单字段
| 字段类型 | 格式要求 | 数量限制 | 必填要求 |
|---------|---------|---------|---------|
| 车辆图片 | 图片，JPEG/PNG，最大10MB | 最多7张 | 至少1张（左前45度） |
| 证件资料 | 图片，JPEG/PNG，最大10MB | 最多4张 | 否 |
| 车辆视频 | 视频，MP4，最大100MB | 最多2个 | 否 |
| 其他图片 | 图片，JPEG/PNG，最大10MB | 最多30张 | 否 |


### 图片和视频上传功能
- 支持图库选择和拍照上传两种方式
- 图片格式支持JPEG、PNG，最大10MB
- 视频格式支持MP4，最大100MB
- 支持图片预览和删除功能
- 上传进度状态和错误提示：上传中/成功/失败
- 支持点击图片进行放大预览，点击视频进行播放操作

### 表单验证规则
- 必填字段非空验证
- 数字字段范围验证
- 手机号格式验证（11位数字）
- 车牌号格式验证
- VIN码格式验证（17位字母数字）
- 日期格式验证
- 文件类型和大小验证

### 行驶证识别功能交互说明
- 在车辆信息Tab中提供"拍摄行驶证自动识别"按钮
- 点击按钮时检查设备摄像头权限
- 权限异常时提示用户："您的设备不支持摄像头功能或未授权访问，请前往设置中开启摄像头权限"
- 检查当前是否有网络，没有网络时提示用户："当前无网络连接，请连接网络后重试"
- 权限正常时调用设备后置摄像头进行拍照
- 拍照完成后显示识别提示："正在识别行驶证信息，请稍候..."
- 识别完成后自动填充可识别的字段并提示："行驶证信息识别完成并已自动填写到表单中"
- 若阿里云接口未能识别到相关信息，提示用户："未识别到行驶证信息，请手动输入"
- 识别结果对应填充的表单字段包括：
  - 车牌号（来自行驶证车牌号码）
  - 车架号（来自行驶证车辆识别代号）
  - 发动机号（来自行驶证发动机号码）
  - 品牌车型（来自行驶证品牌型号，需匹配下拉选项）
  - 上牌时间（来自行驶证注册日期）
  - 原车主名称（来自行驶证所有人姓名）
  - 原车主住址（来自行驶证住址）

### 车架号自动识别功能交互说明
- 在车架号输入框旁边提供"车架号自动识别"按钮
- 点击按钮时检查设备摄像头权限
- 权限异常时提示用户："您的设备不支持摄像头功能或未授权访问，请前往设置中开启摄像头权限"
- 检查当前是否有网络，没有网络时提示用户："当前无网络连接，请连接网络后重试"
- 权限正常时调用设备后置摄像头进行拍照
- 拍照完成后显示识别提示："正在识别车架号，请稍候..."
- 识别完成后自动填充车架号字段并提示："车架号识别完成并已自动填写到表单中"
- 注意：不同主机厂的铭牌上，车架号的呈现形式可能存在差异，因此识别结果会因主机厂不同而有所变化。调用阿里云接口获取字段时，优先获取车辆识别代码；若未获取到，再从识别内容中通过正则表达式搜索符合 17 位英文和数字组合的内容。若依旧未识别到车架号，则提示用户："未识别到车架号，请手动输入"。

### 车牌号重复性检查功能交互说明
- 在用户输入或识别车牌号后，系统自动进行重复性检查
- 如果存在一个评估中的评估单，直接提示："已存在相同车牌号的评估单，是否进入编辑流程？" 若用户选择进入编辑流程，则直接进入编辑页面
- 如果存在一个已报价的评估单，则基于最后一次的报价日期，判断是否在近30个自然日内：
  - 如果评估仍在有效期内（30天内），提示："已存在一个30天内有效评估，是否进入详情查看？" 若用户选择进入详情查看，则直接进入评估详情页面 （即只能在有效的评估单去修改，该类型的车牌号不允许新增）
  - 如果评估单已经无效（超过30天），则不进行提示，可以正常新增评估单。

### 错误处理
- 表单验证错误时显示具体错误信息
- 网络错误时提示用户重试
- 文件上传失败时提供重新上传选项
- 保存失败时保留已填写数据

### 操作流程
1. 用户进入新建评估单页面
2. 默认显示车辆信息Tab，填写基本信息
3. 点击其他Tab切换至相应表单
4. 在图像信息Tab上传相关图片和视频
5. 点击保存按钮提交表单数据
6. 系统验证数据完整性并保存
7. 返回评估单列表页面

### 性能指标
- 页面加载时长：不超过2秒
- 图片上传响应时间：不超过3秒
- 表单提交响应时间：不超过2秒

### 埋点统计规范

#### 通用内容
- 页面信息：记录页面ID或名称
- 打开时间：记录页面加载的时间戳
- 使用者的UUID信息：记录唯一用户ID（从登录会话获取，并匿名化处理）


