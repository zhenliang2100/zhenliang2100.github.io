# 评估单详情页面 PRD

## 1. 需求背景

在二手车交易过程中，评估师需要对车辆进行详细的评估，并记录相关信息。评估单详情页面用于展示车辆的详细信息、评估历史、签约信息、支付信息以及交车确认等，方便评估师和销售人员查看和管理评估单。

## 2. 需求价值

该评估单详情页面能够提升评估师和销售人员的工作效率，通过集中展示车辆的所有相关信息，减少信息查找时间。同时，清晰的Tab分类和时间轴展示有助于更好地理解车辆历史和交易进展，提高客户服务质量。

## 3. 期望结果

- 用户能够查看车辆的详细信息，包括车辆基本信息、牌证信息、图像信息等。
- 用户能够查看评估历史，了解多轮报价的情况。
- 用户能够查看签约信息、支付信息和交车确认信息。
- 页面提供Tab切换功能，方便用户在不同信息模块之间进行切换。

## 4. 功能需求

### 功能描述

提供评估单详情页面，展示车辆的详细信息、评估历史、签约信息、支付信息以及交车确认等。

### 功能路径

功能路径：评估管理 -> 评估单详情

功能权限：评估师、销售人员

### 页面结构

- 顶部导航栏：包含返回按钮和页面标题。
- 工单状态：展示工单编号和工单时间。
- 表单步骤Tab：提供车辆信息、牌证信息、图像信息、评估信息、签约信息、支付信息、交车确认等Tab。
- 表单内容区域：根据选中的Tab展示相应的表单内容。

### Tab功能

- 车辆信息：展示车辆的基本信息，如销售顾问、品牌车型、车架号、车牌号、发动机号、上牌时间、上牌城市、车辆所在地、表显里程、使用性质、所有人性质、天窗、车辆类别、排放标准、内饰颜色、外观颜色、生产日期、指导价、是否购买新车、是否事故、综合评价、车况描述等。
- 牌证信息：展示车辆的牌证信息，如钥匙数、过户次数、交强险到期、年审到期、商业险到期、原车主名称、原车主住址（非必填）、原车主电话等。
- 图像信息：展示车辆的图片、证件资料、车辆视频和其他图片。
- 评估信息：展示多轮报价时间轴，包括每轮报价的评估价格、客户意向报价、客户报价反馈和评估意见。（工单只有经过已报价之后，才会显示相关报价，如没有报价，显示 暂无报价信息）
- 签约信息：展示车辆买卖协议和车辆代管协议的相关信息，如合同编号、签约时间、定金金额、尾款金额、在线查阅合同、交车时间、交车地点等。（从已报价到已签约之后才会显示相关信息）
  - 车辆买卖协议：包含合同模版名称、签约车主、联系方式、身份证号、车主证件（身份证正反面）。
  - 收款人信息：包含收款人姓名、银行卡账号、开户行、收款人证件（身份证正反面、银行卡）。
  - 车辆代管协议：包含合同编号、签约时间、保管人姓名、联系方式、在线查阅合同。（若尚未发起签署车辆代管协议，则相关字段显示 --）
  - 交车信息：包含交车时间和交车地点，时间精确到分钟。
- 支付信息：展示支付相关信息，如支付方式、定金支付时间、定金支付状态、尾款支付时间、尾款支付状态、全款支付时间、全款支付状态等。（只要发起了定金支付、尾款支付或全款支付，即可展示相关信息）
- 交车确认：展示交车确认信息，如确认人、确认时间、车辆图片、证件资料等。
  - 车辆图片：包含正面45°、右侧面、正面、后面、右侧面、更多（其他角度）、铭牌等图片上传区域。
  - 证件资料：包含行驶证、车钥匙、车辆登记证等证件上传区域。
  - 其他证件：包含车辆购置税完税证明、交强险及商业保险单、车辆保养/维修登记手册、购车发票/交易发票等证件的选中状态显示及备注信息输入框。
  - 合同预览：提供车辆交车单和补充协议的在线合同预览链接。
  - 钥匙数：显示交接的钥匙数量。
- 编辑记录：展示评估单的编辑历史，以时间轴形式按信息更新时间倒序排列，显示编辑时的订单状态、变更字段名称、编辑前后的内容及编辑人员姓名。若无编辑记录，则显示“某某时间，首次提交”。

### 缓存机制

由于评估单详情页面包含大量图片和视频内容，为提升页面加载速度和用户体验，需实现简单的缓存机制：

- 首次访问时，将页面内容（包括图片、视频等媒体资源）进行缓存
- 当检测到页面内容发生变更时，自动更新缓存
- 对于超过1个月的缓存内容，系统应自动清除以节省存储空间
- 缓存机制应不影响数据的实时性，确保用户能看到最新的评估单信息

**数据展示条件说明**：

在实际业务中，各Tab的数据展示遵循以下规则：

- 车辆信息、牌证信息、图像信息：这些Tab在所有工单状态下都有数据展示。
- 评估信息：仅在工单状态进入"已报价"之后才会有数据展示，其他状态下显示"暂无数据"。
- 签约信息：需要在发起签约之后（包含签约中状态）才会有数据展示。
- 支付信息：需要在发起定金支付、全款支付或尾款支付之后才有数据展示，即使支付仍在进行中（若处于支付中状态，则对应类型的支付时间字段为空）。
- 交车确认：需要在确认交车之后（状态为已完成）才有相应的数据展示。

### 数据展示

- 所有字段均为只读状态，用户无法编辑。
- 页面默认展示车辆信息Tab的内容。
- 时间格式统一为`YYYY-MM-DD HH:MM:SS`。

### 性能指标

- 页面加载时长（不超过2秒）

### 埋点统计

- 页面信息：评估单详情页面
- 打开时间：记录页面加载的时间戳
- 使用者的UUID信息：记录唯一用户ID（从登录会话获取，并匿名化处理）
- 高级事件：Tab切换点击