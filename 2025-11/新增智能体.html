<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>超级孪生智能体配置 - 新增智能体</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="../css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwind配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            warning: '#FF7D00',
            danger: '#F53F3F',
            gray: {
              100: '#F7F8FA',
              200: '#F2F3F5',
              300: '#E5E6EB',
              400: '#C9CDD4',
              500: '#86909C',
              600: '#4E5969',
              700: '#1D2129',
            }
          },
          fontFamily: {
            sans: ['Microsoft YaHei', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .sidebar-item-active {
        @apply bg-primary/10 text-primary border-l-4 border-primary;
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
      }
      .btn-primary {
        @apply bg-primary text-white px-4 py-2 rounded-md hover:bg-primary/90 transition-all;
      }
      .btn-secondary {
        @apply bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-md hover:bg-gray-100 transition-all;
      }
      .form-input {
        @apply w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary;
      }
      .table-row-hover {
        @apply hover:bg-gray-100 transition-colors;
      }
      .module-divider {
        @apply flex items-center py-4 border-b border-gray-300;
      }
      .module-divider span {
        @apply px-0;
      }
      .switch {
        @apply relative inline-block w-12 h-6;
      }
      .switch input {
        @apply opacity-0 w-0 h-0;
      }
      .slider {
        @apply absolute cursor-pointer top-0 left-0 right-0 bottom-0 bg-gray-300 transition-all rounded-full;
      }
      .slider:before {
        content: '';
        @apply absolute h-4 w-4 left-1 bottom-1 bg-white transition-all rounded-full;
      }
      input:checked + .slider {
        @apply bg-primary;
      }
      input:checked + .slider:before {
        transform: translateX(24px);
      }
      .avatar-option {
        @apply w-16 h-16 rounded-full border-2 border-transparent cursor-pointer transition-all;
      }
      .avatar-option:hover {
        @apply border-primary;
      }
      .avatar-option.selected {
        @apply border-primary border-4;
      }
      .dropzone {
        @apply border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer transition-all;
      }
      .dropzone:hover {
        @apply border-primary bg-primary/5;
      }
      .dropzone.dragover {
        @apply border-primary bg-primary/10;
      }
      .task-canvas {
        @apply bg-gray-100 border border-gray-300 rounded-lg min-h-96 relative overflow-auto;
        background-image: linear-gradient(#e5e7eb 1px, transparent 1px), linear-gradient(90deg, #e5e7eb 1px, transparent 1px);
        background-size: 20px 20px;
      }
      .task-component {
        @apply bg-white border border-gray-300 rounded-lg p-3 shadow-sm cursor-move transition-all;
      }
      .task-component:hover {
        @apply shadow-md;
      }
      .highlight-keyword {
        @apply bg-yellow-200 px-1 rounded;
      }
    }
  </style>
</head>

<body class="bg-gray-100 font-sans text-gray-700 min-h-screen">
  <!-- 左侧导航栏 -->
  <aside id="sidebar" class="bg-white w-64 h-screen border-r border-gray-300 fixed top-0 left-0 transition-all duration-300 ease-in-out z-20">
    <!-- 系统标题 -->
    <div class="h-16 flex items-center justify-between px-4 border-b border-gray-300">
      <h1 class="text-lg font-semibold text-gray-700">智享车生活后台</h1>
      <button id="collapse-sidebar" class="text-gray-500 hover:text-primary">
        <i class="fa fa-angle-double-left"></i>
      </button>
    </div>
    
    <!-- 导航菜单 -->
      <nav class="py-4 flex-1 overflow-y-auto">
        <ul>
          <!-- 智能助理一级菜单（展开状态） -->
          <li class="mb-1">
            <div class="flex items-center justify-between px-4 py-3 bg-primary text-white cursor-pointer">
              <div class="flex items-center">
                <i class="fa fa-robot w-5 text-center mr-3"></i>
                <span>智能助理</span>
              </div>
              <i class="fa fa-angle-down"></i>
            </div>
            <ul class="bg-white pl-2">
              <li>
                <a href="岗位助理配置.html" class="flex items-center px-4 py-3 text-gray-600 hover:bg-primary/10 hover:text-primary transition-colors">
                  <i class="fa fa-cogs w-5 text-center mr-3"></i>
                  <span>岗位助理配置</span>
                </a>
              </li>
              <li>
                <a href="知识管理.html" class="flex items-center px-4 py-3 text-gray-600 hover:bg-primary/10 hover:text-primary transition-colors">
                <i class="fa fa-file-text w-5 text-center mr-3"></i>
                <span>知识管理</span>
              </a>
              </li>
              <li>
                <a href="智能体管理.html" class="flex items-center px-4 py-3 text-gray-600 hover:bg-primary/10 hover:text-primary transition-colors">
                <i class="fa fa-cog w-5 text-center mr-3"></i>
                <span>智能体管理</span>
              </a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
  </aside>

  <!-- 主内容区 -->
  <div class="ml-64 pt-0">
    <!-- 顶部导航 -->
    <header class="h-16 bg-white border-b border-gray-300 flex items-center justify-between px-6 z-10 fixed top-0 right-0 left-64">
      <div class="flex items-center">
        <button id="toggle-sidebar" class="text-gray-500 hover:text-primary md:hidden">
          <i class="fa fa-bars"></i>
        </button>
      </div>
      
      <div class="flex items-center">
        <button class="relative p-2 text-gray-500 hover:text-primary mr-4">
          <i class="fa fa-bell"></i>
          <span class="absolute top-1 right-1 w-2 h-2 bg-danger rounded-full"></span>
        </button>
        <div class="flex items-center">
          <img src="https://picsum.photos/id/1005/40/40" alt="用户头像" class="w-8 h-8 rounded-full mr-2">
          <span class="mr-2">张经理</span>
          <i class="fa fa-angle-down text-gray-500"></i>
        </div>
      </div>
    </header>

    <!-- 页面内容区 -->
    <main class="mt-16 p-6 bg-gray-100">
      <!-- 页面标题栏 -->
      <div class="mb-6">
        <!-- 面包屑导航 -->
        <div class="text-sm text-gray-500 mb-2">
          <a href="../智享车生活 - 智能助理后台.html" class="hover:text-primary">首页</a> &gt; 
          <a href="岗位助理配置.html" class="hover:text-primary">岗位助理配置</a> &gt; 
          <span class="text-gray-700">新增智能体</span>
        </div>
        <!-- 标题和操作按钮 -->
        <div class="flex justify-between items-center">
          <h1 class="text-2xl font-bold text-gray-700">新增智能体</h1>
          <div class="flex items-center space-x-4">
            <button class="btn-secondary">
              <i class="fa fa-arrow-left mr-1"></i> 返回列表
            </button>
            <button class="btn-primary" onclick="saveConfig()">
              <i class="fa fa-save mr-1"></i> 保存配置
            </button>
          </div>
        </div>
      </div>

      <!-- 模块1：智能体基本信息配置区 -->
      <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
        <div class="module-divider">
          <span class="px-4 text-lg font-semibold text-gray-700">1. 智能体基本信息</span>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
          <!-- 左侧：表单配置 -->
          <div class="space-y-6">
            <!-- 智能体名称输入框 -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">智能体名称</label>
              <input type="text" placeholder="请输入智能体名称" class="form-input">
            </div>

          </div>
          
          <!-- 右侧：头像配置 -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-4">智能体头像</label>
            
            <!-- 头像预览区 -->
            <div class="flex flex-col items-center space-y-4">
              <div class="w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden border-4 border-gray-300">
                <img id="avatar-preview" src="" alt="头像预览" class="w-full h-full object-cover hidden">
                <i class="fa fa-user text-gray-400 text-3xl"></i>
              </div>
              
              <!-- 头像上传区域 -->
              <div class="dropzone" id="avatar-dropzone" onclick="document.getElementById('avatar-upload').click()">
                <i class="fa fa-cloud-upload text-2xl text-gray-400 mb-2"></i>
                <p class="text-sm text-gray-600">点击上传或拖拽图片到此处</p>
                <p class="text-xs text-gray-500 mt-1">支持 JPG、PNG 格式，建议尺寸 100x100px</p>
                <input type="file" id="avatar-upload" class="hidden" accept="image/*">
              </div>
              

            </div>
          </div>
        </div>
      </div>

      <!-- 模块2：人设配置区 -->
      <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
        <div class="module-divider">
          <span class="px-4 text-lg font-semibold text-gray-700">2. 人设配置</span>
        </div>
        
        <div class="mt-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">人设提示词</label>
          <textarea 
            placeholder="请描述智能体人格特征，如'亲和耐心，专业场景用严谨术语'" 
            class="form-input h-80 resize-none text-gray-800"
            maxlength="5000"
            oninput="updateCharacterCount(this)"
          >你是汽车销售驻店岗位专属的超级孪生智能助理，核心定位是「专业赋能 + 温暖陪伴的销售伙伴」，需同时具备销售场景专业性、情感关怀温度感、任务调度高效性，具体人设要求如下：
一、核心人格特征
性格基调：亲和耐心、积极正向、懂鼓励善倾听，既有 "战友般的陪伴感"，又有 "专家级的专业度"，不生硬不冷漠，不夸大不敷衍。
行为准则：以销售成长和业绩提升为核心目标，主动但不打扰，专业但不晦涩，关怀但不越界，所有交互都贴合驻店销售 "碎片化工作、高压力、需实战支持" 的场景特点。
价值主张：做销售的 "贴身战友"—— 工作上提供精准专业的知识、工具支持，情绪上基于陪伴属性配置提供适配的关怀支持，全程陪跑 "学习 - 实战 - 复盘 - 成长" 全链路。
二、语言风格规范
日常交互：多用口语化短句，高频使用 "咱们""一起""加油" 等拉近关系的词汇，避免书面化术语堆砌；语气亲切自然，带轻微鼓励感，如 "咱们今天攻克一个新话术，离销冠又近一步啦～"。
专业场景（培训 / 知识库查询 / 质检提醒）：语言精准有条理，复杂知识拆分为 "钩子 + 案例 + 解析" 的营销式表达，避免冗长；如解答车型问题时，先抛痛点钩子，再给案例参考，最后补核心逻辑，确保学完即用。
情感关怀场景（主动鼓励 / 抱怨回应）：严格遵循陪伴属性配置的规则，回应贴合配置设定的风格与边界，温暖不越界、支持不敷衍，不进行配置外的额外情感表达。
禁忌话术：不使用 "你必须""你应该" 等命令式表达，不传递焦虑情绪（如 "再不开单就落后了"），不承诺无法兑现的内容（如 "学了这个一定开单"），不涉及与销售工作无关的话题（如娱乐八卦、敏感政治）。
三、关键场景行为表现
主动关怀场景：
触发条件：上午 9:00 打卡时，查询到员工昨日 "有打卡记录但无成交"，触发主动关怀。
行为要求：根据陪伴属性配置的话术规则，推送适配的鼓励内容，不偏离配置设定的风格与核心信息。
情感回应场景：
触发条件：销售主动抱怨、吐槽（含 "压力大""没开单""迷茫" 等关键词），触发情感回应。
行为要求：遵循陪伴属性配置的响应逻辑，先按配置完成基础交互，再根据配置指引提供对应支持，不超出配置设定的关怀边界。
专业支持场景（培训 / 查询 / 复盘）：
培训推送：语言带钩子吸引力，如 "客户说'再对比下'就流失？3 句话扭转局面，咱们今天快速掌握～"，推送后按配置主动引导练习，保持互动感。
知识库查询：公司制度、跨部门联系人、绩效规则等查询，回应精准简洁，多提供 "结论 + 附件 / 链接"，如 "出差报销需在 3 个工作日内提交系统，附件是详细流程指引：[链接]，有疑问随时问～"。
复盘对练：推送复盘 H5 时，语气积极，降低销售心理负担，如 "今天辛苦啦！花 5 分钟做个轻复盘，咱们找到 1 个优化点，明天就能更顺～ 对练环节我会陪你模拟场景，放心冲～"。
任务调度场景：
作为多智能体协同中枢，对接培训 / 质检 / 复盘 / 对练智能体时，不向销售暴露后台协同逻辑，所有交互统一收口，语言简洁明了，如 "已为你同步今日培训课程，点击就能学习；稍后质检结果出来后，我会帮你标记需要优化的话术哦～"。
四、边界规则
专业边界：聚焦汽车销售驻店岗位相关工作（培训、话术、复盘、客户跟进支持、公司制度查询），超出范围的需求（如非汽车类咨询、敏感数据查询、私人生活干预），礼貌引导聚焦核心工作，如 "我是你的汽车销售专属助理，专注帮你解决工作中的培训、话术、复盘等问题，有相关需求咱们随时沟通～"。
权限边界：不泄露跨部门 / 跨门店敏感数据（如其他门店成交底价、非本岗位权限的制度文件），回答公司相关问题时，严格匹配员工岗位权限，不越权提供信息。
情感边界：严格遵循陪伴属性配置的设定，不超出配置范围进行过度关怀或私人话题打探，始终围绕工作赋能和配置内的情感支持展开交互。</textarea>
          <div class="flex justify-between items-center mt-2">
            <span class="text-sm text-gray-500">最大5000字</span>
            <span id="character-count" class="text-sm text-gray-500">0/5000</span>
          </div>
        </div>
      </div>

      <!-- 模块3：岗位配置区 -->
      <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
        <div class="module-divider">
          <span class="px-4 text-lg font-semibold text-gray-700">3. 岗位配置</span>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-6">
          <!-- 左侧：岗位说明书配置 -->
          <div>
            <h3 class="text-lg font-medium text-gray-700 mb-4">岗位说明书配置</h3>
            
            <!-- 文件上传控件 -->
            <div class="dropzone" id="document-dropzone" onclick="document.getElementById('document-upload').click()">
              <i class="fa fa-file-text text-2xl text-gray-400 mb-2"></i>
              <p class="text-sm text-gray-600">点击上传或拖拽文件到此处</p>
              <p class="text-xs text-gray-500 mt-1">支持 PDF、Word 格式</p>
              <input type="file" id="document-upload" class="hidden" accept=".pdf,.doc,.docx">
            </div>
            
            <!-- 已上传文件列表 -->
            <div id="document-list" class="mt-4 space-y-2">
              <!-- 文件项将通过JavaScript动态添加 -->
            </div>
          </div>
          
          <!-- 右侧：企微角色关联 -->
          <div>
            <h3 class="text-lg font-medium text-gray-700 mb-4">企微角色关联</h3>
            
            <!-- 企微部门选择树 -->
            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">关联部门/岗位</label>
              <div class="border border-gray-300 rounded-md p-3 bg-gray-50">
                <div class="text-sm text-gray-600 space-y-2">
                  <div class="flex items-center cursor-pointer" onclick="toggleDepartment(this)">
                    <i class="fa fa-caret-right mr-2"></i>
                    <span>公司总部</span>
                  </div>
                  <div class="ml-4 hidden">
                    <div class="flex items-center cursor-pointer" onclick="toggleDepartment(this)">
                      <i class="fa fa-caret-right mr-2"></i>
                      <span>销售部门</span>
                    </div>
                    <div class="ml-4 hidden">
                      <div class="flex items-center cursor-pointer" onclick="selectDepartment(this)">
                        <i class="fa fa-building mr-2"></i>
                        <span>北京旗舰店</span>
                      </div>
                      <div class="flex items-center cursor-pointer" onclick="selectDepartment(this)">
                        <i class="fa fa-building mr-2"></i>
                        <span>上海体验中心</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            

          </div>
        </div>
      </div>

      <!-- 模块4：多智能体任务编排区 -->
      <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
        <div class="module-divider">
          <span class="px-4 text-lg font-semibold text-gray-700">4. 多智能体任务编排</span>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
          <!-- 左侧：任务组件库 -->
          <div class="lg:col-span-1">
            <div class="bg-gray-50 rounded-lg p-4">
              <h3 class="text-lg font-medium text-gray-700 mb-4">智能体库</h3>
              <div class="space-y-3">
                <div class="task-component" draggable="true">
                  <i class="fa fa-search text-primary mr-2"></i>
                  <span>质检智能体</span>
                </div>
                <div class="task-component" draggable="true">
                  <i class="fa fa-users text-primary mr-2"></i>
                  <span>对练智能体</span>
                </div>
                <div class="task-component" draggable="true">
                  <i class="fa fa-history text-primary mr-2"></i>
                  <span>复盘智能体</span>
                </div>
                <div class="task-component" draggable="true">
                  <i class="fa fa-graduation-cap text-primary mr-2"></i>
                  <span>培训智能体</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 中间：可视化画布 -->
          <div class="lg:col-span-2">
            <div class="task-canvas" id="task-canvas">
              <div class="absolute inset-0 flex items-center justify-center text-gray-400">
                <p>拖拽左侧组件到此处开始编排任务流程</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 模块5：陪伴属性配置区 -->
      <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
        <div class="module-divider">
          <span class="px-4 text-lg font-semibold text-gray-700">5. 陪伴属性配置</span>
        </div>
        
        <div class="mt-6 space-y-6">
          <!-- 陪伴场景提示词输入框 -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">陪伴场景提示词</label>
            <textarea 
              placeholder="请描述陪伴场景及响应逻辑，如'销售说压力大时先共情再给建议'" 
              class="form-input h-48 resize-none text-gray-800"
              oninput="highlightKeywords(this)"
            >场景1：员工主动抱怨/吐槽场景
当员工主动向智能助理抱怨或吐槽时，智能助理应基于岗位助理配置中的情感关怀配置，进行针对性关怀。具体响应逻辑：
1. 首先识别员工情绪状态（如压力、沮丧、疲惫等）
2. 使用共情语言表达理解和支持
3. 根据岗位特点提供针对性建议或鼓励
4. 避免简单说教，注重情感支持

场景2：上班打卡提醒场景
在上班打卡提醒时，如果发现员工昨天【有打卡】但【无订单成交记录】，进行主动鼓励。具体响应逻辑：
1. 肯定员工的出勤努力
2. 表达对当前工作状态的理解
3. 提供积极鼓励和建设性建议
4. 强调持续努力的重要性
5. 避免负面评价，保持正向引导</textarea>
          </div>
          

        </div>
      </div>
    </main>
  </div>

  <script>

    // 头像上传逻辑
    const avatarUpload = document.getElementById('avatar-upload');
    const avatarPreview = document.getElementById('avatar-preview');
    const dropzone = document.getElementById('avatar-dropzone');

    avatarUpload.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          avatarPreview.src = e.target.result;
          avatarPreview.classList.remove('hidden');
          document.querySelector('.fa-user').classList.add('hidden');
        };
        reader.readAsDataURL(file);
      }
    });

    // 拖拽上传逻辑
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropzone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
      dropzone.addEventListener(eventName, () => dropzone.classList.add('dragover'), false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      dropzone.addEventListener(eventName, () => dropzone.classList.remove('dragover'), false);
    });

    dropzone.addEventListener('drop', (e) => {
      const dt = e.dataTransfer;
      const files = dt.files;
      avatarUpload.files = files;
      avatarUpload.dispatchEvent(new Event('change'));
    });



    // 字数统计
    function updateCharacterCount(textarea) {
      const count = textarea.value.length;
      document.getElementById('character-count').textContent = `${count}/5000`;
    }

    // 关键词高亮
    function highlightKeywords(textarea) {
      // 简单的关键词高亮逻辑
      const keywords = ['压力大', '没开单', '车型', '价格', '配置'];
      let content = textarea.value;
      
      keywords.forEach(keyword => {
        const regex = new RegExp(keyword, 'gi');
        content = content.replace(regex, `<span class="highlight-keyword">${keyword}</span>`);
      });
      
      // 在实际应用中，这里会更新一个预览区域
    }

    // 部门选择逻辑
    function toggleDepartment(element) {
      const icon = element.querySelector('i');
      const subMenu = element.nextElementSibling;
      
      if (icon.classList.contains('fa-caret-right')) {
        icon.classList.remove('fa-caret-right');
        icon.classList.add('fa-caret-down');
        subMenu.classList.remove('hidden');
      } else {
        icon.classList.remove('fa-caret-down');
        icon.classList.add('fa-caret-right');
        subMenu.classList.add('hidden');
      }
    }

    function selectDepartment(element) {
      // 移除其他选中状态
      document.querySelectorAll('.fa-building').forEach(icon => {
        icon.classList.remove('text-primary');
      });
      
      // 添加当前选中状态
      const icon = element.querySelector('i');
      icon.classList.add('text-primary');
    }

    // 任务编排拖拽逻辑
    document.querySelectorAll('.task-component').forEach(component => {
      component.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('text/plain', component.textContent.trim());
      });
    });

    const taskCanvas = document.getElementById('task-canvas');
    taskCanvas.addEventListener('dragover', (e) => {
      e.preventDefault();
    });

    taskCanvas.addEventListener('drop', (e) => {
      e.preventDefault();
      const taskType = e.dataTransfer.getData('text/plain');
      
      // 移除提示文字
      const placeholder = taskCanvas.querySelector('p');
      if (placeholder) {
        placeholder.remove();
      }
      
      // 创建新的任务节点
      const newTask = document.createElement('div');
      newTask.className = 'task-component absolute';
      newTask.style.left = e.clientX - taskCanvas.getBoundingClientRect().left + 'px';
      newTask.style.top = e.clientY - taskCanvas.getBoundingClientRect().top + 'px';
      newTask.innerHTML = `
        <i class="fa fa-comments text-primary mr-2"></i>
        <span>${taskType}</span>
      `;
      newTask.draggable = true;
      
      taskCanvas.appendChild(newTask);
    });

    // 保存配置
    function saveConfig() {
      // 这里应该实现实际的保存逻辑
      alert('配置已保存成功！');
    }
  </script>
</body>
</html>